dbGetQuery(con, paste(
  "
  DROP TABLE IF EXISTS PRI500, PRI500_B, pri_b;
  
  CREATE TABLE PRI500_B(
  UC CHARACTER(191));
  
  COPY  PRI500_B
  FROM 'C:/Users/Public/Documents/DESEMPLEO/RECAUDO/PRI/500/",PRI500_TXT,"';
  
  DELETE FROM PRI500_B
  WHERE UC LIKE '%0-%';
  
  SELECT
  
  ",FECHA," AS FEC_CARTERA,
  CAST(SUBSTRING(UC,	1	,	1	)AS 	INT	)	AS	TIPO_TRANS	,
  CAST(SUBSTRING(UC,	2	,	5	)AS 	INT	)	AS	PROD_BOL	,
  CAST(SUBSTRING(UC,	7	,	5	)AS 	INT	)	AS	SUB_PROD	,
  CAST(SUBSTRING(UC,	12	,	3	)AS 	INT	)	AS	OPC	,
  CAST(SUBSTRING(UC,	15	,	3	)AS 	INT	)	AS	ALT	,
  CAST(SUBSTRING(UC,	18	,	21	)AS 	TEXT	)	AS	NUM_CRED	,
  CAST(SUBSTRING(UC,	39	,	8	)AS 	TEXT	)	AS	FECINI_VIG	,
  CAST(SUBSTRING(UC,	47	,	12	)AS 	NUMERIC	)	AS	PRIMA_TOTAL	,
  CAST(SUBSTRING(UC,	59	,	12	)AS 	NUMERIC	)	AS	IVA	,
  CAST(SUBSTRING(UC,	71	,	12	)AS 	NUMERIC	)	AS	Mensualidad	,
  CAST(SUBSTRING(UC,	83	,	12	)AS 	TEXT	)	AS	otra	,
  CAST(SUBSTRING(UC,	95	,	13	)AS 	BIGINT	)	AS	num_pol	,
  CAST(SUBSTRING(UC,	108	,	8	)AS 	TEXT	)	AS	fecini_factura	,
  CAST(SUBSTRING(UC,	116	,	8	)AS 	TEXT	)	AS	fecfin_factura	
  
  INTO PRI500
  FROM PRI500_B;
  
  DROP TABLE PRI500_B;
  
  
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  
  DROP TABLE IF EXISTS PRI501, PRI501_B;
  
  CREATE TABLE PRI501_B(
  UC CHARACTER(191));
  
  COPY  PRI501_B
  FROM 'C:/Users/Public/Documents/DESEMPLEO/RECAUDO/PRI/501/",PRI501_TXT,"';
  
  DELETE FROM PRI501_B
  WHERE UC LIKE '%0-%';
  
  SELECT
  
  ",FECHA," AS FEC_CARTERA,
  CAST(SUBSTRING(UC,	1	,	1	)AS 	INT	)	AS	TIPO_TRANS	,
  CAST(SUBSTRING(UC,	2	,	5	)AS 	INT	)	AS	PROD_BOL	,
  CAST(SUBSTRING(UC,	7	,	5	)AS 	INT	)	AS	SUB_PROD	,
  CAST(SUBSTRING(UC,	12	,	3	)AS 	INT	)	AS	OPC	,
  CAST(SUBSTRING(UC,	15	,	3	)AS 	INT	)	AS	ALT	,
  CAST(SUBSTRING(UC,	18	,	21	)AS 	TEXT	)	AS	NUM_CRED	,
  CAST(SUBSTRING(UC,	39	,	8	)AS 	TEXT	)	AS	FECINI_VIG	,
  CAST(SUBSTRING(UC,	47	,	12	)AS 	NUMERIC	)	AS	PRIMA_TOTAL	,
  CAST(SUBSTRING(UC,	59	,	12	)AS 	NUMERIC	)	AS	IVA	,
  CAST(SUBSTRING(UC,	71	,	12	)AS 	NUMERIC	)	AS	Mensualidad	,
  CAST(SUBSTRING(UC,	83	,	12	)AS 	TEXT	)	AS	otra	,
  CAST(SUBSTRING(UC,	95	,	13	)AS 	BIGINT	)	AS	num_pol	,
  CAST(SUBSTRING(UC,	108	,	8	)AS 	TEXT	)	AS	fecini_factura	,
  CAST(SUBSTRING(UC,	116	,	8	)AS 	TEXT	)	AS	fecfin_factura	
  
  
  INTO PRI501
  FROM PRI501_B;
  
  DROP TABLE PRI501_B;
  
  
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  
  
  INSERT INTO PRI500
  SELECT*
  FROM PRI501;
  
  WITH A AS (
  SELECT*, TO_DATE(FECINI_VIG,'DDMMYYYY') AS FECINIVIG
  FROM PRI500
  )
  ,

  a3 as (
  select a.*, a2.fecha_emision
  from a left join fec_emi_des a2 on
  a.num_pol=a2.numero_poliza and
  a.prod_bol=a2.ram
  )
  ,

  b as (

  select a3.*, tasas_tc.tasa_reaseguro as tc_re, tasas_tc.tasa_com as TC_com, tasas_tc.cesion_com as cesion_com 
  from a3 left join tasas_tc on
  a3.prod_bol=tasas_tc.producto and
  a3.sub_prod=tasas_tc.sub_producto and
  a3.opc=tasas_tc.opcion and
  a3.alt=tasas_tc.alternativa
  )

  
  SELECT *,
  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2015' THEN 0.4950
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2015' THEN 0.4950
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.4950 
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.3780 
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.3520
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.3840
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.3840 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.3360
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.4070
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.3240
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.3840
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.3840 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.3360
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.3800
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.3240
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.3980
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.3980 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.361
  
  -- FALTAN LAS tdc
  
  WHEN PROD_BOL=501 AND FECHA_EMISION <='04-07-2017' THEN cesion_com

  WHEN PROD_BOL=501 AND FECHA_EMISION > '04-07-2017' AND FECHA_EMISION <='31-03-2018' THEN cesion_com/(1.12245)

  WHEN PROD_BOL=501 AND FECHA_EMISION > '31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN cesion_com*(1+0.02703) -- Incremento en cesion comercial por amento de tasa y aumento de prima com

  ELSE 0
  END AS porc_cesion_EMSION,

  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2015' THEN 0.026100
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.02946 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.0327330 
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.017421 
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.026100
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.02946 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.022374
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.017421
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.0302440 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.024146
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.02946
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.022374
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.0302440
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.017421
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.0282530 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.022528
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.02946
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.0232170
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.0282530
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN  0.0187380
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.0282530
  
  -- FALTAN LAS tdc
  
  WHEN PROD_BOL=501 AND FECHA_EMISION <='31-03-2018' THEN tc_re

  WHEN PROD_BOL=501 AND FECHA_EMISION > '31-01-2018' THEN tc_re*(1+.14) -- Incremento en Tasa RE

  
  ELSE 0
  END AS tasa_re_EMSION,


  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.06393
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2015' THEN  0.04148
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.06393 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION <='31-01-2017' AND FECHA_EMISION >'31-01-2015' THEN 0.04148

  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.06393
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-01-2017' AND FECHA_EMISION <='31-03-2018' THEN 0.04148
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.05951 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECHA_EMISION >'31-03-2018' AND FECHA_EMISION <='31-01-2019' THEN 0.04148
  
  -- FALTAN LAS tdc

  WHEN PROD_BOL=501 AND FECHA_EMISION <='04-07-2017' THEN tc_com

  WHEN PROD_BOL=501 AND FECHA_EMISION > '04-07-2017' THEN tc_com*(1.12245) --incremento en tarifa comerical

  ELSE 0
  END AS tasa_COMERCIAL_EMSION,





  







  




  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2015' THEN 0.4950
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2015' THEN 0.4950
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.4950 
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.4320 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.3780 
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.3520
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.3840
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.3840 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.3360
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.4070
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.3240
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.3840
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.3840 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.3360
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.3800
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.3240
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.3960
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.3980
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.4400
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.3980 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.361
  
  -- FALTAN LAS tdc
  
  WHEN PROD_BOL=501 AND FECINIVIG <='04-07-2017' THEN cesion_com
  
  WHEN PROD_BOL=501 AND FECINIVIG > '04-07-2017' AND FECINIVIG <='31-03-2018' THEN cesion_com/(1.12245)
  
  WHEN PROD_BOL=501 AND FECINIVIG > '31-03-2018' AND FECINIVIG <='31-01-2019' THEN cesion_com*(1+0.02703) -- Incremento en cesion comercial por amento de tasa y aumento de prima com
  
  ELSE 0
  END AS porc_cesion_VIGENCIA,
  
  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2015' THEN 0.026100
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.02946 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.0327330 
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.017421 
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.026100
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.02946 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.022374
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.0327330
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.017421
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.0302440 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.024146
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.02946
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.022374
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.0302440
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.022374 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.017421
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.0282530 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.022528
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.02946
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.0232170
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.0282530
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN  0.0187380
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.0282530
  
  -- FALTAN LAS tdc
  
  WHEN PROD_BOL=501 AND FECINIVIG <='31-03-2018' THEN tc_re
  
  WHEN PROD_BOL=501 AND FECINIVIG > '31-01-2018' THEN tc_re*(1+.14) -- Incremento en Tasa RE
  
  
  ELSE 0
  END AS tasa_re_VIGENCIA,
  
  
  CASE
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.06393
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2015' THEN  0.04148
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.06393 
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG <='31-01-2017' AND FECINIVIG >'31-01-2015' THEN 0.04148
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.06393
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-01-2017' AND FECINIVIG <='31-03-2018' THEN 0.04148
  
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT <=6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.05951 
  WHEN PROD_BOL=500 AND SUB_PROD = 1 	AND ALT  >6 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 2 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 502 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.04661
  WHEN PROD_BOL=500 AND SUB_PROD = 503 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.05951
  WHEN PROD_BOL=500 AND SUB_PROD = 504 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.04661 
  WHEN PROD_BOL=500 AND SUB_PROD = 505 	AND ALT  >0 AND FECINIVIG >'31-03-2018' AND FECINIVIG <='31-01-2019' THEN 0.04148
  
  -- FALTAN LAS tdc
  
  WHEN PROD_BOL=501 AND FECINIVIG <='04-07-2017' THEN tc_com
  
  WHEN PROD_BOL=501 AND FECINIVIG > '04-07-2017' THEN tc_com*(1.12245) --incremento en tarifa comerical
  
  ELSE 0
  END AS tasa_COMERCIAL_VIGENCIA




  INTO PRI_B
  FROM b;
  
  INSERT INTO PRI
  SELECT*
  FROM PRI_B; 
  
  
  
  
  DROP TABLE IF EXISTS PRI_BACKUP,PRI_B;
  
  SELECT*
  INTO PRI_BACKUP
  FROM PRI;
  
  DROP TABLE PRI501, PRI500;
  
  
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
  
  "
  ,sep=""))









  dbGetQuery(con,paste(
    "
    DROP TABLE IF EXISTS CAN500, CAN500B;
    
    CREATE TABLE CAN500B(
    UC CHARACTER(191));
    
    COPY  CAN500B
    FROM 'C:/Users/Public/Documents/DESEMPLEO/RECAUDO/CAN/500/",CAN500_TXT,"';
    
    SELECT
    ",FECHA," AS FEC_CARTERA,
    CAST(SUBSTRING(UC,	1	,	1	)AS 	INT	)	AS	TIPO_TRAS	,
    CAST(SUBSTRING(UC,	2	,	5	)AS 	INT	)	AS	PROD_BOL	,
    CAST(SUBSTRING(UC,	7	,	5	)AS 	INT	)	AS	SUB_PROD	,
    CAST(SUBSTRING(UC,	12	,	3	)AS 	INT	)	AS	OPC	,
    CAST(SUBSTRING(UC,	15	,	3	)AS 	INT	)	AS	ALT	,
    CAST(SUBSTRING(UC,	18	,	1	)AS 	TEXT	)	AS	TIPO_REEMB	,
    CAST(SUBSTRING(UC,	19	,	21	)AS 	TEXT	)	AS	NUM_CRED	,
    CAST(SUBSTRING(UC,	40	,	13	)AS 	BIGINT	)	AS	NUM_POL	,
    CAST(SUBSTRING(UC,	53	,	8	)AS 	TEXT	)	AS	FEC_CANCEL	,
    CAST(SUBSTRING(UC,	61	,	3	)AS 	INT	)	AS	TIPO_CANCEL	,
    CAST(SUBSTRING(UC,	64	,	8	)AS 	TEXT	)	AS	FECINI_VIG	,
    CAST(SUBSTRING(UC,	72	,	12	)AS 	NUMERIC	)	AS	REEMBOLSO	
    
    INTO CAN500
    FROM CAN500B;
    
    DROP TABLE CAN500B;
    
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    
    DROP TABLE IF EXISTS CAN501, CAN501B;
    
    CREATE TABLE CAN501B(
    UC CHARACTER(191));
    
    COPY  CAN501B
    FROM 'C:/Users/Public/Documents/DESEMPLEO/RECAUDO/CAN/501/",CAN501_TXT,"';
    
    -- DELETE FROM CAN500B
    -- WHERE UC LIKE '%0-%';
    
    SELECT
    ",FECHA," AS FEC_CARTERA,
    CAST(SUBSTRING(UC,	1	,	1	)AS 	INT	)	AS	TIPO_TRAS	,
    CAST(SUBSTRING(UC,	2	,	5	)AS 	INT	)	AS	PROD_BOL	,
    CAST(SUBSTRING(UC,	7	,	5	)AS 	INT	)	AS	SUB_PROD	,
    CAST(SUBSTRING(UC,	12	,	3	)AS 	INT	)	AS	OPC	,
    CAST(SUBSTRING(UC,	15	,	3	)AS 	INT	)	AS	ALT	,
    CAST(SUBSTRING(UC,	18	,	1	)AS 	TEXT	)	AS	TIPO_REEMB	,
    CAST(SUBSTRING(UC,	19	,	21	)AS 	TEXT	)	AS	NUM_CRED	,
    CAST(SUBSTRING(UC,	40	,	13	)AS 	BIGINT	)	AS	NUM_POL	,
    CAST(SUBSTRING(UC,	53	,	8	)AS 	TEXT	)	AS	FEC_CANCEL	,
    CAST(SUBSTRING(UC,	61	,	3	)AS 	INT	)	AS	TIPO_CANCEL	,
    CAST(SUBSTRING(UC,	64	,	8	)AS 	TEXT	)	AS	FECINI_VIG	,
    CAST(SUBSTRING(UC,	72	,	12	)AS 	NUMERIC	)	AS	REEMBOLSO	
    
    INTO CAN501
    FROM CAN501B;
    
    DROP TABLE CAN501B;
    
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
    
    INSERT INTO CAN500
    SELECT*
    FROM CAN501;
    
    


    INSERT INTO CAN
    SELECT*
    FROM CAN500;
    
    
    DROP TABLE CAN501, CAN500;
    


    
    "  
    ,sep=''))
